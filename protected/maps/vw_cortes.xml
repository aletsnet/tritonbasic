<?xml version="1.0" encoding="utf-8"?>
<sqlMap namespace="Cortes">
    <select id="vwFoliosCortes" resultClass="LCtFoliosCreditos">
        SELECT
                f.*
        FROM
                ct_folios_creditos f
        INNER JOIN
                ms_ventas v
            ON
                f.id_ventas = v.id_ventas
        WHERE
                f.borrado = 0
            AND
                v.id_cortes = #id_corte#
    </select>
    <select id="vwProductosVendidos" resultClass="Array">
        SELECT
                a.codigo,
                a.nombre,
                concat(SUM(c.cantidad),' ', b.unidad )cantidad, 
                SUM(c.precio_vendido) monto
        FROM
                ms_productos a
        INNER JOIN
                ms_inventarios b
            ON
                a.id_productos = b.id_productos
        INNER JOIN
                ct_ventas_detalle c
            ON
                b.id_inventarios = c.id_inventarios
        INNER JOIN
                ms_ventas d
            ON d.id_ventas = c.id_ventas
        WHERE
            d.id_cortes = #id_corte#
			AND 
				d.estatus = 3
        GROUP BY
            b.id_inventarios
        ORDER BY
            monto DESC
    </select>
    <select id="vwDepartamentosVendidos" resultClass="Array">
        SELECT
                d.id_departamentos folio,
                d.nombre nombre,
                COUNT(d.id_departamentos) unidades,
                sum(c.precio_vendido) monto
        FROM
            ct_ventas_detalle c
        INNER JOIN
                ms_inventarios b
            ON
                c.id_inventarios = b.id_inventarios
        INNER JOIN
                ms_productos a
            ON
                b.id_productos = a.id_productos
        INNER JOIN
                ct_departamentos d
            ON
                d.id_departamentos = a.id_departamentos
        INNER JOIN
                ms_ventas e
            ON
                    e.id_ventas = c.id_ventas
                AND
                    e.estatus IN (3,7)
        WHERE
            e.id_cortes = #idcorte#
        GROUP BY
            d.id_departamentos
        ORDER BY
            folio
    </select>
    
    <select id="vwDepartamentosDesglose" resultClass="Array">
        SELECT
            a.codigo folio,
            a.nombre nombre,
            COUNT(a.id_productos) unidades,
            sum(c.precio_vendido) monto
	FROM
        ct_ventas_detalle c 
	INNER JOIN
            ms_inventarios b
        ON
            c.id_inventarios = b.id_inventarios
	INNER JOIN
            ms_productos a
        ON
            b.id_productos = a.id_productos
	INNER JOIN
            ct_departamentos d
        ON
            d.id_departamentos = a.id_departamentos
	INNER JOIN
            ms_ventas e
        ON
                e.id_ventas = c.id_ventas
            AND
                e.estatus IN (3,7)
	WHERE
            e.id_cortes = #idcorte#
        AND
            d.id_departamentos = #folio#
	GROUP BY
        b.id_productos
    </select>
</sqlMap>